const questions = [
    { q: "1-Hayatında şu an eksikliğini derinden hissettiğin, ruhuna en çok yabancı gelen şey nedir?", choices: ["Bağışlama", "Tutku", "Özgüven", "Huzur"] },
    { q: "2-Kendini en çok nerede kaybettiğini hissediyorsun?", choices: ["Geçmişte", "Toplumsal beklentilerde", "Başarısızlık korkusunda", "Hayallerini unutarak"] },
    { q: "3-Geçmişindeki hangi duygu, sende en kalıcı izleri bırakmakta?", choices: ["Öfke", "Korku", "Üzüntü", "Yalnızlık"] },
    { q: "4-Hayatında bir kapıyı aralama şansın olsa, hangi kapının ardındaki bilinmezi keşfetmeyi seçerdin?", choices: ["Affetme Kapısı", "Kendi Gücümü Bulma Kapısı", "Bilinmeyene Cesaret Kapısı", "Kaybolan Tutkular Kapısı"] },
    { q: "5-Kendi iç sesin sana en çok ne söylüyor?", choices: ["Harekete geç", "Daha çok sev", "Affet", "Kendini keşfet"] },
    { q: "6-En büyük korkun ne?", choices: ["Başarısız olmak", "Sevilmemek", "Kendi potansiyelimi kullanamamak", "Yalnız kalmak"] },
    { q: "7-Hayatta neye en çok ihtiyaç duyuyorsun?", choices: ["Huzur", "Cesaret", "İlham", "Bağlılık"] }
];

function generateArelMessage(answers) {
    const messages = {
        "Bağışlama": "Affetmek, ruhunun zincirlerinden kurtulmasıdır...",
        "Tutku": "Tutkularını takip et, çünkü onlar seni gerçekten kim olduğunla buluşturur...",
        "Özgüven": "Özgüven, içindeki gücün en saf yansımasıdır...",
        "Huzur": "Huzuru dışarıda arama, çünkü gerçek huzur içindedir...",
        "Korku": "Korkuların seni tanımlamaz; onlar yalnızca geçici bir yankıdır...",
        "Geçmiş": "Geçmişin yükünü omuzlarından at, çünkü o sadece seni geride tutan bir anıdır...",
        "Cesaret": "Kendi yolunu çiz, çünkü hiçbir harita seni tam olarak senin olduğun yere götüremez..."
    };
    
    let frequency = {};
    
    // Seçilen yanıtları say
    answers.forEach(answer => {
        frequency[answer] = (frequency[answer] || 0) + 1;
    });
    
    // En sık seçilen cevabı bul
    let mostFrequent = Object.keys(frequency).reduce((a, b) => frequency[a] > frequency[b] ? a : b, null);
    
    return mostFrequent ? messages[mostFrequent] : "Cevaplarınıza göre analiz yapılamadı.";
}

function startQuestions() {
    currentStep = 0;
    answers = [];
    nextQuestion();
}

function nextQuestion() {
    if (currentStep < questions.length) {
        document.querySelectorAll('.step').forEach(el => el.classList.remove('active'));
        document.getElementById('question-container').classList.add('active');
        document.getElementById('question-text').innerText = questions[currentStep].q;
        let choicesContainer = document.getElementById('choices-container');
        choicesContainer.innerHTML = '';
        questions[currentStep].choices.forEach(choice => {
            let btn = document.createElement('button');
            btn.innerText = choice;
            btn.onclick = () => storeAnswer(choice);
            choicesContainer.appendChild(btn);
        });
    } else {
        analyzeAnswers();
    }
}

function storeAnswer(choice) {
    answers.push(choice);
    currentStep++;
    nextQuestion();
}

function analyzeAnswers() {
    document.querySelectorAll('.step').forEach(el => el.classList.remove('active'));
    document.getElementById('step9').classList.add('active');
    document.getElementById('arelMessage').innerText = generateArelMessage(answers);
}

function nextStep(step) {
    document.querySelectorAll('.step').forEach(el => el.classList.remove('active'));
    document.getElementById('step' + step).classList.add('active');
    if (step === 10) {
        startCamera();
    }
}

function startCamera() {
    if (navigator.mediaDevices && navigator.mediaDevices.getUserMedia) {
        navigator.mediaDevices.getUserMedia({ video: true })
            .then(stream => {
                const video = document.getElementById('video');
                video.srcObject = stream;
            })
            .catch(err => {
                console.error("Kamera açılırken hata oluştu: ", err);
            });
    } else {
        console.error("Tarayıcı kamera erişimini desteklemiyor.");
    }
}

function restart() {
    window.location.reload();
}
   
